import{useCallback as V,useEffect as I,useState as X}from"react";var[J,K,B]=[new Map,new EventTarget,new BroadcastChannel("useSyncState")];class D{q;O;x;constructor(q,O,x){this.type=q;this.key=O;this.value=x}}function Y(q,O){const[x,Q]=X(J.has(q)?J.get(q):O),F=V((j)=>{if(j.key===q&&j.value!==x)switch(j.type){case 0:{B.postMessage(new D(1,q,x));break}case 1:{Q(j.value);break}}},[q,x]);I(()=>{function j(z){F(z.detail)}return K.addEventListener(":3",j),()=>K.removeEventListener(":3",j)},[F]),I(()=>{function j(z){F(z.data)}return B.addEventListener("message",j),()=>B.removeEventListener("message",j)},[F]),I(()=>{function j(z){if(!document.hidden)B.postMessage(new D(0,q,x))}return document.addEventListener("visibilitychange",j),()=>document.removeEventListener("visibilitychange",j)},[q,x]),I(()=>{B.postMessage(new D(0,q,x))},[]);const W=V((j)=>{const z=j instanceof Function?j(x):j;if(z!==x){const U=new D(1,q,z);Q(z),K.dispatchEvent(J.set(q,z)&&new CustomEvent(":3",{detail:U})),B.postMessage(U)}},[q,x]);return[x,W]}export{Y as default};
