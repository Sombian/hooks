import{useEffect as V,useState as Z}from"react";var X=new Set;class F{w;C;J;constructor(w,C,J){this.type=w;this.path=C;this.data=J}}class H{w;C;J;constructor(w,C,J){this.type=w;this.path=C;this.data=J}}var D=new SharedWorker("data:text/javascript;base64,"+btoa(String.fromCodePoint(...(new TextEncoder()).encode("("+function(){const w=[],C=new Map;self.addEventListener("connect",(J)=>{const x=J.ports[0];x.addEventListener("message",(M)=>{const j=M.data;switch(j.type){case 0:{if(!C.has(j.path))x.postMessage(new H(0,j.path,null));else{const B=C.get(j.path);if(B==="init")x.postMessage(new H(1,j.path,null));else x.postMessage(new H(2,j.path,B.value))}break}case 1:{C.set(j.path,{since:Date.now(),value:j.data});for(let B of w)if(x!==B)B.postMessage(new H(2,j.path,j.data));break}case 2:{C.set(j.path,"init");for(let B of w)if(x!==B)B.postMessage(new H(1,j.path,null));break}}}),w.push(x),x.start()})}.toString()+")()"))));D.port.start();function $(w,C,J={}){const[x,M]=Z();return V(()=>{function j(B){const Q=B.data;if(Q.path===w)switch(Q.type){case 0:{if(!X.has(w))X.add(w),D.port.postMessage(new F(2,w)),C().then((Y)=>{M(Y),X.delete(w),D.port.postMessage(new F(1,w,Y))});break}case 2:{if(Q.data!==x)M(Q.data);break}}}return D.port.addEventListener("message",j),()=>D.port.removeEventListener("message",j)},[w,x,C]),V(()=>{function j(B){if(!document.hidden)D.port.postMessage(new F(0,w))}return document.addEventListener("visibilitychange",j),()=>document.removeEventListener("visibilitychange",j)},[w]),V(()=>{function j(B){D.port.postMessage(new F(0,w))}return window.addEventListener("online",j),()=>window.removeEventListener("online",j)},[w]),V(()=>{if(navigator.onLine)D.port.postMessage(new F(0,w))},[]),{data:x}}export{$ as default};
